var screenWidth = $(window).width();

function getUrlParams(dParam) {
    var dPageURL = window.location.search.substring(1),
        dURLVariables = dPageURL.split('&'),
        dParameterName;

    for (let i = 0; i < dURLVariables.length; i++) {
        dParameterName = dURLVariables[i].split('=');

        if (dParameterName[0] === dParam) {
            return dParameterName[1] === undefined ? true : decodeURIComponent(dParameterName[1]);
        }
    }
}

// Add these function definitions before your window load event
function adjustContentHeight() {
    const windowHeight = $(window).height();
    const headerHeight = $('header').outerHeight() || 0;
    const footerHeight = $('footer').outerHeight() || 0;
    $('.content-area').css('min-height', windowHeight - headerHeight - footerHeight);
}

function adjustContentPosition() {
    const headerHeight = $('header').outerHeight() || 0;
    $('.main-content').css('padding-top', headerHeight);
}

// Then your window load event
jQuery(window).on("load", function() {
    $('#preloader').fadeOut(500);
    $('#main-wrapper').addClass('show');
    $('select').selectpicker();
    adjustContentHeight();
    adjustContentPosition();
});

jQuery(window).on('resize', function() {
    adjustContentPosition();
    adjustContentHeight();
});

(function($) {
    "use strict";

    $("#menu").metisMenu();

    $("#checkAll").change(function() {
        $("td input:checkbox").prop('checked', $(this).prop("checked"));
    });

    $(".nav-control").on('click', function() {
		$('#main-wrapper').toggleClass("menu-toggle");
		$(".hamburger").toggleClass("is-active");
		if ($('#main-wrapper').hasClass("menu-toggle")) {
			$(this).css('left', '80px'); // Menú colapsado
		} else {
			$(this).css('left', '240px'); // Menú expandido
		}
		// Espera a que termine la transición CSS antes de recalcular
		$('.deznav').one('transitionend', function() {
			adjustContentPosition();
		});
		
	});

    function adjustContentPosition() {
		const sidebar = $('.deznav');
		let sidebarWidth = $('#main-wrapper').hasClass("menu-toggle") ? '5rem' : sidebar.outerWidth() + 'px';
		$('.content-body').css('margin-left', sidebarWidth);
	}

    function adjustContentHeight() {
		const winHeight = window.outerHeight > 0 ? window.outerHeight : screen.height;
		const headerHeight = $('.header').innerHeight();
		$(".content-body").css({
			"min-height": (winHeight - headerHeight) + "px",
			"padding-top": headerHeight + "px" // Añade padding-top
		});
	}

    $(window).scroll(function() {
        const headerHeight = $('.header').innerHeight();
        if ($('body').attr('data-layout') === "horizontal" && $('body').attr('data-header-position') === "static" && $('body').attr('data-sidebar-position') === "fixed") {
            $(this).scrollTop() >= headerHeight ? $('.deznav').addClass('fixed') : $('.deznav').removeClass('fixed');
        }
    });

    jQuery('.dz-scroll').each(function() {
        const scroolWidgetId = jQuery(this).attr('id');
        new PerfectScrollbar('#' + scroolWidgetId, {
            wheelSpeed: 2,
            wheelPropagation: true,
            minScrollbarLength: 20
        });
    });

    $('.btn-number').on('click', function(e) {
        e.preventDefault();
        const fieldName = $(this).attr('data-field');
        const type = $(this).attr('data-type');
        const input = $("input[name='" + fieldName + "']");
        const currentVal = parseInt(input.val());
        input.val(!isNaN(currentVal) ? (type === 'minus' ? currentVal - 1 : currentVal + 1) : 0);
    });

    jQuery('.dz-fullscreen').on('click', function() {
        if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        } else {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.mozRequestFullScreen) {
                document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.msRequestFullscreen) {
                document.documentElement.msRequestFullscreen();
            }
        }
    });

})(jQuery);
